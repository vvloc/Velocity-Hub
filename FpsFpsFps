--// Ultimate Lag Fix + Memory Stabilizer for Mobile Roblox
local Players = game:GetService("Players")
local Lighting = game:GetService("Lighting")
local Terrain = workspace:FindFirstChildOfClass("Terrain")
local RunService = game:GetService("RunService")
local Debris = game:GetService("Debris")

local player = Players.LocalPlayer

-- Lighting cleanup
pcall(function()
	Lighting.GlobalShadows = false
	Lighting.FogEnd = 1e10
	Lighting.Brightness = 0
	Lighting.Ambient = Color3.new(0, 0, 0)
	for _, v in pairs(Lighting:GetChildren()) do
		if v:IsA("PostEffect") then
			v.Enabled = false
		end
	end
end)

-- Terrain cleanup
if Terrain then
	Terrain.WaterWaveSize = 0
	Terrain.WaterWaveSpeed = 0
	Terrain.WaterReflectance = 0
	Terrain.WaterTransparency = 1
end

-- Massive memory saver: disable and clean dynamic effects
local function hardOptimize(obj)
	if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Smoke") or obj:IsA("Fire") then
		obj.Enabled = false
	elseif obj:IsA("Explosion") or obj:IsA("ForceField") then
		obj:Destroy()
	elseif obj:IsA("BasePart") then
		obj.Material = Enum.Material.SmoothPlastic
		obj.Reflectance = 0
	end
end

for _, obj in ipairs(workspace:GetDescendants()) do
	hardOptimize(obj)
end

workspace.DescendantAdded:Connect(hardOptimize)

-- Force render quality down to reduce resource demand
pcall(function()
	settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
end)

-- Attempt to kill stuttering by disabling 3D rendering briefly
-- (mobile trick to force GPU reload)
RunService:Set3dRenderingEnabled(false)
task.wait(0.5)
RunService:Set3dRenderingEnabled(true)

-- Optional: Set FPS cap (only applies if using executor like Synapse)
pcall(function()
	setfpscap(90)
end)

-- Reclaim memory aggressively every 5 seconds
task.spawn(function()
	while true do
		collectgarbage("collect")
		task.wait(5)
	end
end)

-- Hide name tags and other BillboardGuis to reduce overdraw
for _, v in pairs(workspace:GetDescendants()) do
	if v:IsA("BillboardGui") then
		v.Enabled = false
	end
end

print("[ðŸ”§ Mobile Lag Stabilizer] Running | FPS drop prevention active")
